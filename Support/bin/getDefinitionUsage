#!/bin/sh
#
# Copyright 2011 - Versatile Knowlege Systems - www.verknowsys.com
#
# Authors:
#   Daniel (dmilith) Dettlaff
#   Tymon (teamon) Tobolski

export CODE="scala"
if [ "$1" != "" ]; then
    export CODE="$1" # first param: code type. By default "scala"
fi
WORD="$2"
WORKING_DIR="$TM_PROJECT_DIRECTORY"
if [ "$WORKING_DIR" = "" ]; then
    WORKING_DIR="$(pwd)"
fi
LIST="$(find "$WORKING_DIR" -name "*.${CODE}")"
export sub="var entries = ["

for element in $LIST; do
    ENTRIES="$(grep -iP -n "(new|with|\=)(\s*)${WORD}" $element)"
    if [ "$ENTRIES" != "" ]; then
        export sub="$sub{file: '$element', entries: '${ENTRIES}'}, "
    fi
done

sub="$sub]; var tmdir = '$TM_PROJECT_DIRECTORY';"
echo "$sub"