#!/bin/sh
#
# Copyright 2011 - Versatile Knowlege Systems - www.verknowsys.com
#
# Authors:
#   Daniel (dmilith) Dettlaff
#   Tymon (teamon) Tobolski

export CODE="scala"
if [ "$1" != "" ]; then
    export CODE="$1" # first param: code type. By default "scala"
fi

export TYPE="class|object|trait"
if [ "$2" != "" ]; then
    export TYPE="$2" # second param: what we looking for. By default classes, traits & objects
fi

WORKING_DIR="$TM_PROJECT_DIRECTORY"
if [ "$WORKING_DIR" = "" ]; then
    WORKING_DIR="$(pwd)"
fi
LIST="$(find "$WORKING_DIR" -name "*.${CODE}")"

export sub="var entries = ["
for element in $LIST; do
    ENTRY="$(grep -iP -n "(^\s*)(${TYPE})" $element)"
    if [ "$ENTRY" != "" ]; then
        LINE="$(echo $ENTRY | cut -d ':' -f1)"
        CLASS="$(echo $ENTRY | cut -d ':' -f2)"
        export sub="$sub{file: '$element', entry: '${ENTRY}'}, "
    fi
done

sub="$sub]; var tmdir = '$TM_PROJECT_DIRECTORY';"
echo "$sub"
